!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.SMSBumpKlaviyoForms=e():t.SMSBumpKlaviyoForms=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){(function(){let t={},e=function(){try{let t=__st.cid;if(null!=t&&""!==t)return t}catch(t){return 0}try{let t=window.ShopifyAnalytics.meta.page.customerId;if(null!=t&&""!==t)return t}catch(t){return 0}try{let t=window.meta.page.customerId;if(null!=t&&""!==t)return t}catch(t){return 0}return 0},n=function(){let t="";return"undefined"!=typeof Shopify&&(null!=Shopify.shop?t=Shopify.shop:null!=Shopify.Checkout.apiHost&&(t=Shopify.Checkout.apiHost)),t},r=function(e=!1){return e?!!t.hasOwnProperty(e)&&t[e]:t},o=function(t,e,n=0){let r={customer_id:n,store:t};for(const[t,n]of Object.entries(e))r[t]=n;return JSON.stringify(r)},i=function(e){t=e},u=function(t){return t&&t.$phone_number},a=function(t){return t&&t.$email};var c=function(t){t&&"function"==typeof t?"ie"!=(document.attachEvent&&void 0!==document.attachEvent?"ie":"not-ie")?window.addEventListener("klaviyoForms",(function(e){return t(e)})):window.attachEvent("klaviyoForms",(function(e){if("complete"===window.readyState)return t(e)})):console.error("The callback is not a function!")};let f={},l={},s={},d=function(t){return s[p(t)]},p=function(t){return t.formId},m=function(t){let e=u(t.metaData),n=a(t.metaData),r=p(t);return JSON.stringify([r,e,n])};const y=["POPUP","FLYOUT"];let b=function(t){let e=t.type,n=p(t),r=s[n]=s[n]||{};if(r._y_eventType=e,"close"===e)return!0;if("stepSubmit"===e){let e=u(t.metaData),n=a(t.metaData),o=function(t){let e=`[data-testid="klaviyo-form-${p(t)}"]`,n=document.querySelector(e);if(n&&"FORM"==n.nodeName){let t=10,e=n.parentNode;for(;e&&t--;){let t=e.getAttribute("data-testid");if(t&&"DIV"==e.nodeName)return-1!=y.indexOf(t)?"POPUP":"EMBEDED";if(e=e.parentNode,"BODY"==e.nodeName)return"EMBEDED"}}return!1}(t);return r._y_formType=o,"EMBEDED"==o||!1===o?!!e||!!n:!(!e||!n)}return!1},h=function(t){i(t),c((function(t){let i=t.detail;i.metaData=Object.assign(i.metaData||{},function(t){let e=p(t);if(!1!==e){let n=u(t.metaData),r=a(t.metaData);return f[e]=Object.assign(Object.assign(f[e]||{},t.metaData)||{},n&&{$phone_number:n},r&&{$email:r}),f[e]}return{}}(i)),b(i)&&!1===function(t){let e=m(t);return!1!==e&&!0===l[e]}(i)&&!0===(t=>{let i=t.metaData,c=n(),f=u(i),l=a(i),s=!(!f&&!l);if(Object.keys(i).length<=0||!1===s)return!1;let p=e(),m=r("url");if(Object.assign(i,d(t)),!1!==m){let t=new XMLHttpRequest;return t.open("POST",r("url"),!0),t.setRequestHeader("Access-Control-Allow-Origin","*"),t.setRequestHeader("Content-Type","application/json;charset=UTF-8"),t.send(o(c,i,p)),t.onreadystatechange=()=>{if(t.readyState===XMLHttpRequest.DONE&&200===t.status){let t=new CustomEvent("SMSKlaviyoFormSubmit",{detail:{store:c,subscriber_data:i,customer_id:p}});window.dispatchEvent(t)}},!0}return!1})(i)&&function(t){let e=m(t);!1!==e&&(l[e]=!0)}(i)}))};return{init:function(t){return h(t)}}})().init({url:"https://sqs-webhooks.smsbump.com/forms-subscription"})}])}));